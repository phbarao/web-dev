(window.webpackJsonp=window.webpackJsonp||[]).push([[9,6],{3433:function(e,t,n){"use strict";n.r(t);var r=n(521),o=n(447),i=n(104),a=n(22);function u(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,c,"next",e)}function c(e){u(i,r,o,a,c,"throw",e)}a(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var l=Object(a.default)("ion:sugar:lib:DataSource"),p=!1,d=[],b=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=void 0,this.tableName=void 0,this.persistState=void 0,this.state=void 0,this.namespace=void 0,this.dataSourceReady=void 0,this.dataSourceInitialized=void 0,this.resolveReady=void 0,this.resolveInit=void 0,this.unsubscribeFns=void 0,this.name=n,this.tableName=r,this.persistState=o,this.setState(t,!0),this.unsubscribeFns=[],this.initPromises(),d.push(this)}return f(e,null,[{key:"getInstances",value:function(){return d}},{key:"reset",value:function(){p=!1}}]),f(e,[{key:"initPromises",value:function(){var e=this;this.dataSourceReady=new Promise(function(t){e.resolveReady=function(){t()}}),this.dataSourceInitialized=new Promise(function(t){e.resolveInit=t})}},{key:"subscribe",value:function(){throw new Error("must override subscribe")}},{key:"unsubscribe",value:function(){this.unsubscribeFns&&this.unsubscribeFns.length&&(this.unsubscribeFns.forEach(function(e){return e(!0)}),this.unsubscribeFns=[])}},{key:"init",value:function(e){var t=this;return new Promise(function(n){if(t.setState(t.initialState,!0),t.namespace=e,!1===t.persistState)return n();t.loadState().then(function(){return n()})}).then(this.subscribe).then(this.resolveInit)}},{key:"deInit",value:function(){var e=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataSourceInitialized;case 2:this.unsubscribe(),this.initPromises(),this.setState(this.initialState,!0),this.unpublish();case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e,t){Object.freeze(e),this.state=e,this.publish(),!t&&this.persistState&&p&&this.saveState(e)}},{key:"getPersistenceName",value:function(){return"ds_".concat(this.tableName)}},{key:"publish",value:function(){i.a.publish("datasources.".concat(this.name),"update",this.mapInternalToExternalState(this.getState()))}},{key:"unpublish",value:function(){i.a.clearTopics("datasources.".concat(this.name))}},{key:"saveState",value:function(e){return r.default.set(Object(o.a)(this.namespace),this.getPersistenceName(),this.dehydrateState(e))}},{key:"saveCurrentState",value:function(){return this.saveState(this.getState())}},{key:"deleteState",value:function(e){var t=this;return new Promise(function(){return r.default.set(Object(o.a)(e),t.getPersistenceName(),void 0)})}},{key:"loadState",value:function(){var e=this;return new Promise(function(t){if(!e.getPersistenceName())return t();r.default.get(Object(o.a)(e.namespace),e.getPersistenceName()).then(function(n){n&&e.setState(e.rehydrateState(n),!0),t()})})}},{key:"dehydrateState",value:function(e){return e}},{key:"rehydrateState",value:function(e){return e}},{key:"mapInternalToExternalState",value:function(e){return e}},{key:"reducer",value:function(e,t){return t.type,e}},{key:"dispatch",value:function(e){d.forEach(function(t){return t._dispatch(e)})}},{key:"_dispatch",value:function(e){var t=this.getState(),n=this.reducer(t,e);n!==t&&this.setState(n,!1)}},{key:"initialState",get:function(){throw new Error("should be overridden")}}]),e}();function y(){return h.apply(this,arguments)}function h(){return(h=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(d.map(function(){var e=c(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dataSourceInitialized;case 2:if(!t.persistState){e.next=5;break}return e.next=5,t.saveCurrentState();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function g(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function S(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){g(i,r,o,a,u,"next",e)}function u(e){g(i,r,o,a,u,"throw",e)}a(void 0)})}}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&k(e.prototype,t),n&&k(e,n),e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.subscribe("sync.initialsyncdone",function(){!1===p?(l.log("Initial Load finished."),p=!0,y(),Promise.all(d.map(function(e){return e.dataSourceInitialized.then(function(){e.publish(),e.resolveReady()})})).then(function(){return i.a.publish("app.loading","isLoading",!1,!1)})):i.a.publish("app.loading","isLoading",!1,!1)}),i.a.register("sync.persist",c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.log("persisting DataSource"),e.next=3,y();case 3:case"end":return e.stop()}},e,this)})));var A={UPDATE_ATTACHMENTS:"SUGAR/ATTACHMENTS/UPDATE_ATTACHMENTS"},_={},N="SUGAR/ATTACHMENTS_DATASOURCE",P=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=E(this,O(t).call(this,_,"attachments",N,!0))).subscribe=function(){var t=i.a.subscribe("attachments",function(t){switch(t.type){case"update":return e.Actions.update(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,b),T(t,[{key:"initialState",get:function(){return _}},{key:"Constants",get:function(){return A}}]),T(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case A.UPDATE_ATTACHMENTS:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){m(e,t,n[t])})}return e}({},e,t.attachments);default:return e}}},{key:"Actions",get:function(){var e=this;return{update:function(t){e.dispatch({type:A.UPDATE_ATTACHMENTS,attachments:t})}}}},{key:"Utils",get:function(){return{}}}]),t}()),R=P;function U(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("attachments.actions.getattachments",S(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.dataSourceInitialized;case 2:return e.abrupt("return",P.getState());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("attachments.actions.getattachment",function(){var e=S(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.dataSourceInitialized;case 2:return e.abrupt("return",P.getState()[t]);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var K={SET_COMM_ENGINE:"SUGAR/COMM_ENGINE/SET_COMM_ENGINE"},F={commEngine:null},B="SUGAR/COMM_ENGINE_DATASOURCE",M=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=G(this,j(t).call(this,F,"commengine",B,!0))).subscribe=function(){var t=i.a.subscribe("commengine",function(t){switch(t.type){case"set":return e.Actions.set(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,b),D(t,[{key:"initialState",get:function(){return F}},{key:"Constants",get:function(){return K}}]),D(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case K.SET_COMM_ENGINE:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){C(e,t,n[t])})}return e}({},e,{commEngine:t.commEngine});default:return e}}},{key:"Actions",get:function(){var e=this;return{getCommEngine:function(){return e.getState().commEngine},set:function(t){e.dispatch({type:K.SET_COMM_ENGINE,commEngine:t})}}}},{key:"Utils",get:function(){return{}}}]),t}()),V=M;function H(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t,n){return t&&q(e.prototype,t),n&&q(e,n),e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("commengine.actions.getcommengine",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){U(i,r,o,a,u,"next",e)}function u(e){U(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",M.Actions.getCommEngine());case 1:case"end":return e.stop()}},e,this)})));var Z=Object(a.default)("ion:sugar:Config"),$={SET_CONFIG:"SUGAR/CONFIG/SET_CONFIG"},ee={},te="SUGAR/CONFIG_DATASOURCE",ne=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=X(this,Y(t).call(this,ee,"config",te,!0))).subscribe=function(){var t=i.a.subscribe("config",function(t){switch(Z.log("Config subscriber",t),t.type){case"setConfig":var n=t.data,r=n.key,o=n.value;return e.Actions.setConfig(r,o)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,b),Q(t,[{key:"initialState",get:function(){return ee}},{key:"Constants",get:function(){return $}}]),Q(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case $.SET_CONFIG:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){z(e,t,n[t])})}return e}({},e,z({},t.key,t.value));default:return e}}},{key:"Actions",get:function(){var e=this;return{setConfig:function(t,n){e.dispatch({type:$.SET_CONFIG,key:t,value:n})}}}}]),t}()),re=ne;i.a.register("config.actions.getConfig",function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){H(i,r,o,a,u,"next",e)}function u(e){H(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ne.getState()[t]);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var oe=n(433);function ie(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ce(e,t,n[t])})}return e}function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function se(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pe(e,t,n){return t&&le(e.prototype,t),n&&le(e,n),e}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var be,ye=Object(a.default)("ion:sugar:Promotion");!function(e){e.UPDATE_PROMOTIONS="SUGAR/PROMOTION/UPDATE_PROMOTIONS",e.UPDATE_CROSS_PROMOTIONS="SUGAR/PROMOTION/UPDATE_CROSS_PROMOTIONS",e.DELETE_PROMOTIONS="SUGAR/PROMOTION/DELETE_PROMOTIONS"}(be||(be={}));var he="SUGAR/PROMOTION_DATASOURCE",ge={promotions:{},crossPromotionInfo:null},Se=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=se(this,fe(t).call(this,ge,"promotion",he,!0))).Constants=be,e.subscribe=function(){var t=i.a.subscribe("promotion",function(t){switch(ye.log("Promotion Status subscriber ",t),t.type){case"updatePromotion":return e.Actions.updatePromotions([t.data]);case"updatePromotions":return e.Actions.updatePromotions(t.data);case"updateCrossPromotions":return e.Actions.updateCrossPromotions(t.data);case"deletePromotion":return e.Actions.deletePromotions([t.data]);case"deletePromotions":return e.Actions.deletePromotions(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,b),pe(t,[{key:"initialState",get:function(){return ge}}]),pe(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case be.UPDATE_PROMOTIONS:return ue({},e,{promotions:t.promotions.reduce(function(e,t){var n=t.promotionId;if(null==n)return e;var r=ue({},e[n]||{},t);return e[n]=r,e},ue({},e.promotions))});case be.UPDATE_CROSS_PROMOTIONS:return ue({},e,{crossPromotionInfo:t.crossPromotionInfo});case be.DELETE_PROMOTIONS:var n=t.promotionIds,r=ue({},e),o=r.promotions;return n.reduce(function(e,t){return delete e[t],e},o),r;default:return e}}},{key:"Actions",get:function(){var e=this;return{updatePromotions:function(t){e.dispatch({type:be.UPDATE_PROMOTIONS,promotions:t})},updateCrossPromotions:function(t){e.dispatch({type:be.UPDATE_CROSS_PROMOTIONS,crossPromotionInfo:t})},deletePromotions:function(t){e.dispatch({type:be.DELETE_PROMOTIONS,promotionIds:t})}}}}]),t}()),ve=Se;function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Oe(e,t,n[t])})}return e}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ke(e,t){return!t||"object"!==me(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t,n){return t&&we(e.prototype,t),n&&we(e,n),e}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("promotion.actions.getCrossPromotionInfo",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ie(i,r,o,a,u,"next",e)}function u(e){ie(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se.dataSourceInitialized;case 2:return e.abrupt("return",Se.getState().crossPromotionInfo||null);case 3:case"end":return e.stop()}},e,this)})));oe.FlowIds;var Ne=oe.initialState,Pe="SUGAR/FLOW_DATASOURCE",Re=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ke(this,Te(t).call(this,Ne,"flow",Pe,!1))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(t,b),Ae(t,[{key:"subscribe",value:function(){}},{key:"initialState",get:function(){return Ne}}]),Ae(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case be.UPDATE_PROMOTIONS:return t.promotions.filter(function(t){return t.promotionId&&null!=e[t.promotionId]}).reduce(function(e,t){var n=t.shownCount,r=t.promotionId,o=t.optedOut,i=n>0||!!o;return e[r]=Ee({},e[r],{completed:i}),e},Ee({},e));default:return e}}}]),t}()),Ue=n(387);function Ie(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){je(e,t,n[t])})}return e}function je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xe(e,t){return!t||"object"!==Ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ke(e,t,n){return t&&Le(e.prototype,t),n&&Le(e,n),e}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=Object(a.default)("ion:sugar:HVA"),Me={UPDATE_HVAS:"SUGAR/HVA/UPDATE_HVAS"},Ve="SUGAR/HVA_DATASOURCE",He=Ue.a.HVAUtils.initialState,We=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=xe(this,De(t).call(this,He,"hva",Ve,!1))).Constants=Me,e.subscribe=function(){var t=i.a.subscribe("promotion",function(n){switch(Be.log("Promotion Status subscriber ",n),n.type){case"updatePromotion":return e.Actions.updateHVAs([n.data]);case"updatePromotions":return e.Actions.updateHVAs(n.data)}e.unsubscribeFns=[t]})},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(t,b),Ke(t,[{key:"initialState",get:function(){return He}}]),Ke(t,[{key:"mapInternalToExternalState",value:function(e){var t=Ge({},e),n=t.groupHVAs,r=t.individualHVAs,o=Object.keys(n).reduce(function(e,t){var n=e[t],r=n.promotion&&n.promotion.optedOut;return null!=r&&(n.isComplete=r),e},n),i=Object.keys(r).reduce(function(e,t){var n=e[t],r=o[n.parentId],i=r&&r.isComplete||n.promotion&&n.promotion.optedOut;return null!=i&&(n.isComplete=i),e},r);return{groupHVAs:o,individualHVAs:i}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Me.UPDATE_HVAS:var n=Ge({},e),r=n.groupHVAs,o=n.individualHVAs;return t.promotions.forEach(function(e){var t=e.promotionId,n=r[t],i=o[t];n?n.promotion=e:i&&(i.promotion=e)}),n;default:return e}}},{key:"Actions",get:function(){var e=this;return{updateHVAs:function(t){e.dispatch({type:Me.UPDATE_HVAS,promotions:t})}}}}]),t}());i.a.register("hva.actions.complete",function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ie(i,r,o,a,u,"next",e)}function u(e){Ie(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.call("promotion.actions.show",[t]));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var ze,Xe=n(369);function Ye(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function qe(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ye(i,r,o,a,u,"next",e)}function u(e){Ye(i,r,o,a,u,"throw",e)}a(void 0)})}}function Qe(e){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ze(e,t,n[t])})}return e}function Ze(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e,t){return!t||"object"!==Qe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nt(e,t,n){return t&&tt(e.prototype,t),n&&tt(e,n),e}function rt(e,t){return(rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(ze||(ze={})).SET_IDENTITIES="SUGAR/IDENTITIES/SET_IDENTITIES";var ot={identities:{}},it="SUGAR/IDENTITY_DATASOURCE",at=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=$e(this,et(t).call(this,ot,"identity",it,!0))).subscribe=function(){var t=i.a.subscribe("identity",function(t){switch(t.type){case"set":return e.Actions.set(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(t,b),nt(t,[{key:"initialState",get:function(){return ot}},{key:"Constants",get:function(){return ze}}]),nt(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case ze.SET_IDENTITIES:return Je({},e,{identities:Je({},e.identities,t.identities)});default:return e}}},{key:"Actions",get:function(){var e=this;return{getIdentities:function(){return e.getState().identities},getIdentitiesForUser:function(t){var n=e.Actions.getIdentities(),r=Number(t),o="string"==typeof t&&!Number.isInteger(r);return Object.values(n).filter(function(e){return(o?e.contact&&e.contact.id===t:e.userId===r)&&!e.deactivated})},getIdentitiesForUsers:function(t){return t.map(function(t){var n=e.Actions.getIdentitiesForUser(t);if(n.length>0)return n[0];var r=Number(t),o="string"==typeof t&&!Number.isInteger(r),i=o?Xe.ContactType.EMAIL:Xe.ContactType.EVERNOTE;return Je({id:NaN,contact:{id:t.toString(),type:i}},o?{}:{userId:r})})},set:function(t){t&&e.dispatch({type:ze.SET_IDENTITIES,identities:t.reduce(function(e,t){return null!=t.id&&(e[t.id]=t),e},{})})}}}},{key:"Utils",get:function(){return{}}}]),t}()),ut=at;i.a.register("identity.actions.getidentities",qe(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",at.Actions.getIdentities());case 1:case"end":return e.stop()}},e,this)}))),i.a.register("identity.actions.getidentitiesforusers",function(){var e=qe(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",at.Actions.getIdentitiesForUsers(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("identity.actions.getidentitiesforuser",function(){var e=qe(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",at.Actions.getIdentitiesForUser(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var ct,st=n(56),ft=n.n(st);function lt(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function pt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){lt(i,r,o,a,u,"next",e)}function u(e){lt(i,r,o,a,u,"throw",e)}a(void 0)})}}function dt(e){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ht(e,t,n[t])})}return e}function ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gt(e,t){return!t||"object"!==dt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mt(e,t,n){return t&&vt(e.prototype,t),n&&vt(e,n),e}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e.EXPUNGE_LINKED_NOTEBOOKS="SUGAR/LINKED_NOTEBOOK/EXPUNGE_LINKED_NOTEBOOKS",e.UPDATE_LINKED_NOTEBOOKS="SUGAR/LINKED_NOTEBOOK/UPDATE_LINKED_NOTEBOOKS",e.UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP="SUGAR/LINKED_NOTEBOOK/UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP",e.UPDATE_LINKED_NOTEBOOK_USN="SUGAR/LINKED_NOTEBOOK_UPDATE_LINKED_NOTEBOOK_USN"}(ct||(ct={}));var Ot={dirtyGuids:new Set,linkedNotebookToAttachment:{},linkedNotebookToUsn:{},linkedNotebooks:{}},kt="SUGAR/LINKED_NOTEBOOK_DATASOURCE",Tt=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=gt(this,St(t).call(this,Ot,"linkednotebook",kt,!0))).subscribe=function(){var t=i.a.subscribe("linkednotebook",function(t){switch(t.type){case"updateLinkedNotebook":return e.Actions.updateLinkedNotebooks([t.data]);case"updateLinkedNotebooks":return e.Actions.updateLinkedNotebooks(t.data);case"updateLinkedNotebooktoAttachmentMap":return e.Actions.updateLinkedNotebooktoAttachmentMap(t.data);case"expungeLinkedNotebook":return e.Actions.expungeLinkedNotebooks([t.data]);case"expungeLinkedNotebooks":return e.Actions.expungeLinkedNotebooks(t.data);case"updateLinkedNotebookUsn":return e.Actions.updateLinkedNotebookUsn(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(t,b),mt(t,[{key:"initialState",get:function(){return Ot}},{key:"Constants",get:function(){return ct}}]),mt(t,[{key:"mapInternalToExternalState",value:function(e){return{linkedNotebooks:e.linkedNotebooks,linkedNotebookToAttachment:e.linkedNotebookToAttachment}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case ct.UPDATE_LINKED_NOTEBOOKS:var n=t.linkedNotebooks;return yt({},e,{linkedNotebooks:n.reduce(function(e,t){var n=t.guid,r=bt(t,["guid"]);return n&&(e[n]=yt({},r,{guid:n})),e},yt({},e.linkedNotebooks))});case ct.EXPUNGE_LINKED_NOTEBOOKS:var r=t.guids;if(null==r||0===r.length)return e;var o=r.reduce(function(e,t){return delete e[t],e},yt({},e.linkedNotebooks)),i=r.filter(function(t){return null!=e.linkedNotebooks[t]}).map(function(t){return e.linkedNotebooks[t].sharedNotebookGlobalId}).reduce(function(e,t){return null!=t&&delete e[t],e},yt({},e.linkedNotebookToAttachment)),a=r.reduce(function(e,t){return delete e[t],e},yt({},e.linkedNotebookToUsn));return yt({},e,{linkedNotebooks:o,linkedNotebookToAttachment:i,linkedNotebookToUsn:a});case ct.UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP:var u=t.attachmentGuid,c=t.linkedNotebookGuid,s=e.linkedNotebooks[c].sharedNotebookGlobalId;return s?yt({},e,{linkedNotebookToAttachment:yt({},e.linkedNotebookToAttachment,ht({},s,u))}):e;case ct.UPDATE_LINKED_NOTEBOOK_USN:var f=t.linkedNotebookGuid,l=t.updateCount;return yt({},e,{linkedNotebookToUsn:yt({},e.linkedNotebookToUsn,ht({},f,l))});default:return e}}},{key:"Actions",get:function(){var e=this;return{expungeLinkedNotebooks:function(t){e.dispatch({type:ct.EXPUNGE_LINKED_NOTEBOOKS,guids:t})},updateLinkedNotebooks:function(t){e.dispatch({type:ct.UPDATE_LINKED_NOTEBOOKS,linkedNotebooks:t})},updateLinkedNotebooktoAttachmentMap:function(t){var n=t.attachmentGuid,r=t.linkedNotebookGuid;e.dispatch({type:ct.UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP,attachmentGuid:n,linkedNotebookGuid:r})},updateLinkedNotebookUsn:function(t){var n=t.linkedNotebookGuid,r=t.updateCount;e.dispatch({type:ct.UPDATE_LINKED_NOTEBOOK_USN,linkedNotebookGuid:n,updateCount:r})}}}}]),t}()),wt=Tt;i.a.register("linkednotebook.actions.hasnotebook",function(){var e=pt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:return e.abrupt("return",Object.values(Tt.getState().linkedNotebookToAttachment).includes(t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getlinkednotebookguids",function(){var e=pt(regeneratorRuntime.mark(function e(t){var n,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:return n=Tt.getState(),r=n.linkedNotebookToAttachment,o=n.linkedNotebooks,i=ft.a.invert(r||{})[t],e.abrupt("return",ft.a.filter(o,function(e){return e.sharedNotebookGlobalId===i}).map(function(e){return e.guid}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.hasservicenotebook",function(){var e=pt(regeneratorRuntime.mark(function e(t){var n,r,o,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:if(n=Tt.getState(),r=n.linkedNotebooks,o=n.linkedNotebookToAttachment,i=r[t],null!=(a=i.sharedNotebookGlobalId)){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",o[a]);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getFromGlobalId",function(){var e=pt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:return e.abrupt("return",ft.a.filter(Tt.getState().linkedNotebooks,function(e){return e.sharedNotebookGlobalId===t}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getByGuid",function(){var e=pt(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:return n=Tt.getState(),r=n.linkedNotebooks,e.abrupt("return",r[t]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getlinkednotebook",function(){var e=pt(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:if(n=Tt.getState(),r=n.linkedNotebookToAttachment,null!=(o=ft.a.invert(r||{})[t])){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,i.a.call("linkednotebook.actions.getFromGlobalId",o);case 8:return e.abrupt("return",e.sent[0]);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getdirty",pt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:if((t=Tt.getState()).dirtyGuids){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",Array.from(t.dirtyGuids).map(function(e){return t.linkedNotebooks[e]}));case 6:case"end":return e.stop()}},e,this)}))),i.a.register("linkednotebook.actions.getLinkedNotebookUsn",function(){var e=pt(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Tt.dataSourceInitialized;case 2:return n=Tt.getState(),r=n.linkedNotebookToUsn,e.abrupt("return",r[t]||0);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var At=n(379),_t=n(111),Nt=n(671),Pt=n(564),Rt=n(446),Ut=n(511),It=n(662),Ct=n(397);function Gt(e,t){return Object.keys(t).reduce(function(n,r){var o=e[r];return n[r]=o?ft.a.pick(o,Array.from(t[r])):{guid:r,isDeleted:!0},n},{})}function jt(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function xt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){jt(i,r,o,a,u,"next",e)}function u(e){jt(i,r,o,a,u,"throw",e)}a(void 0)})}}function Dt(e){return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Kt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ft(e,t){return!t||"object"!==Dt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vt(e,t,n){return t&&Mt(e.prototype,t),n&&Mt(e,n),e}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){zt(e,t,n[t])})}return e}function zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xt,Yt="SUGAR/WORKSPACE_DATASOURCE";function qt(e,t){var n=Wt({},t.workspaces),r=Wt({},t.invitations),o=Wt({},t.identityByInvitationsGuid),i=Wt({},t.memberships),a=Wt({},t.workspaceRestrictions),u=Wt({},t.notebookGuids),c=Wt({},t.accessInfo),s=Wt({},t.notebookRestrictions),f=Wt({},t.aggregations),l=Wt({},t.activeMemberList);return e.forEach(function(e){delete n[e],delete r[e],delete o[e],delete i[e],delete a[e],delete u[e],delete c[e],delete s[e],delete f[e],delete l[e]}),Wt({},t,{workspaces:n,invitations:r,identityByInvitationsGuid:o,memberships:i,workspaceRestrictions:a,notebookGuids:u,accessInfo:c,notebookRestrictions:s,aggregations:f,activeMemberList:l,catchupGuids:ft.a.difference(t.catchupGuids,e)})}!function(e){e.UPDATE_WORKSPACES="SUGAR/WORKSPACE/UPDATE_WORKSPACES",e.SAVE_WORKSPACE="SUGAR/WORKSPACE/SAVE_WORKSPACE",e.LEAVE_WORKSPACE="SUGAR/WORKSPACE/LEAVE_WORKSPACE",e.EXPUNGE_WORKSPACES="SUGAR/WORKSPACE/EXPUNGE_NOTEBOOKS",e.SET_WORKSPACE_USER_INTERFACE_PROPERTIES="SUGAR/WORKSPACE/SET_WORKSPACE_USER_INTERFACE_PROPERTIES",e.SET_ACTIVE_MEMBERS="SUGAR/WORKSPACE/SET_ACTIVE_MEMBERS",e.NEEDS_CATCHUP="SUGAR/WORKSPACE/NEEDS_CATCHUP",e.DID_CATCHUP="SUGAR/WORKSPACE/DID_CATCHUP",e.CLEAR_DIRTY_GUID="SUGAR/WORKSPACE/CLEAR_DIRTY_GUID"}(Xt||(Xt={}));var Qt={workspaces:{},accessInfo:{},aggregations:{},identityByInvitationsGuid:{},invitations:{},memberships:{},notebookGuids:{},notebookRestrictions:{},workspaceRestrictions:{},workspaceUserInterfaceProperties:{},activeMemberList:{},catchupGuids:[],dirtyFlagsCollection:{}},Jt=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ft(this,Bt(t).call(this,Qt,"workspace",Yt,!0))).subscribe=function(){var t=i.a.subscribe("workspace",function(t){switch(t.type){case"setWorkspaceUserInterfaceProperties":return e.Actions.setWorkspaceUserInterfaceProperties(t.data);case"expungeWorkspace":return e.Actions.expunge([t.data]);case"expungeWorkspaces":return e.Actions.expunge(t.data);case"updateWorkspace":return e.Actions.update([t.data]);case"updateWorkspaces":return e.Actions.update(t.data);case"needsCatchup":return e.Actions.needsCatchup(t.data);case"didCatchup":return e.Actions.didCatchup(t.data)}}),n=i.a.subscribe("notebook",function(t){switch(t.type){case"setNotebooksInWorkspaces":It.getActiveUsersForSpaces(t.data).then(function(t){e.Actions.setActiveUsers(t)})}});e.unsubscribeFns=[t,n]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(t,b),Vt(t,[{key:"initialState",get:function(){return Qt}},{key:"Constants",get:function(){return Xt}}]),Vt(t,[{key:"mapInternalToExternalState",value:function(e){var t=e.accessInfo,n=e.activeMemberList,r=e.aggregations,o=e.identityByInvitationsGuid,i=e.invitations,a=e.memberships,u=e.notebookRestrictions,c=e.notebookGuids,s=e.workspaceRestrictions,f=e.workspaces,l=e.workspaceUserInterfaceProperties;return Object.entries(f).reduce(function(e,f){var p=Kt(f,2),d=p[0],b=p[1],y=t[d],h=b.backingNotebookGuid;return null==h?e:(e[d]=Wt({},b,{guid:d,backingNotebookGuid:h,accessInfo:y,aggregations:r[d],identityByInvitationsGuid:o[d],invitations:i[d],memberships:a[d],notebookGuids:c[d],notebookRestrictions:u[d],restrictions:s[d],activeMembers:n[d]||[],isSeen:It.isSeen(y),workspaceUserInterfaceProperties:l[d]||null}),e)},{})}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Xt.UPDATE_WORKSPACES:var n=t.workspaces,r=Wt({},e.workspaces),o=Wt({},e.invitations),i=Wt({},e.identityByInvitationsGuid),a=Wt({},e.memberships),u=Wt({},e.workspaceRestrictions),c=Wt({},e.notebookGuids),s=Wt({},e.accessInfo),f=Wt({},e.notebookRestrictions),l=Wt({},e.aggregations);return n.forEach(function(t){var n=t.workspace?t.workspace.guid:t.workspaceGuid;if(null==n)throw new Error("updating a workspace requires a valid guid");var p=r[n];if(null!=p){var d=e.dirtyFlagsCollection[n];if(d){var b=ft.a.pick(p,Array.from(d));Object.assign(t.workspace,b)}}else{var y=e.dirtyFlagsCollection[n];if(y&&y.has("isDeleted"))return}r[n]=t.workspace||e.workspaces[n],o[n]=t.invitations||e.invitations[n],i[n]=t.identityByInvitationsGuid||e.identityByInvitationsGuid[n],a[n]=t.memberships||e.memberships[n],u[n]=t.workspaceRestrictions||e.workspaceRestrictions[n],c[n]=t.notebookGuids||e.notebookGuids[n],s[n]=t.accessInfo||e.accessInfo[n],f[n]=t.notebookRestrictions||e.notebookRestrictions[n],l[n]=t.aggregations||e.aggregations[n]}),Wt({},e,{workspaces:r,invitations:o,identityByInvitationsGuid:i,memberships:a,workspaceRestrictions:u,notebookGuids:c,accessInfo:s,notebookRestrictions:f,aggregations:l});case Xt.SAVE_WORKSPACE:var p=t.workspace,d=p.guid;if(null==d)throw new Error("saving a workspace requires a valid guid");var b=Wt({},e.workspaces);p.guid&&(b[p.guid]=Wt({},b[p.guid],p));var y=Wt({},e.dirtyFlagsCollection),h=y[d]||new Set;return Object.keys(p).forEach(function(e){h.add(e)}),y[d]=h,Wt({},e,{workspaces:b,dirtyFlagsCollection:y});case Xt.LEAVE_WORKSPACE:var g=t.guid,S=qt([g],e),v=Wt({},e.dirtyFlagsCollection);return v[g]=new Set(["isDeleted"]),Wt({},S,{dirtyFlagsCollection:v});case Xt.EXPUNGE_WORKSPACES:return qt(t.guids,e);case Xt.SET_WORKSPACE_USER_INTERFACE_PROPERTIES:var m=Wt({},e.workspaceUserInterfaceProperties);return m[t.guid]=t.workspaceUserInterfaceProperties,Wt({},e,{workspaceUserInterfaceProperties:m});case Xt.SET_ACTIVE_MEMBERS:return Wt({},e,{activeMemberList:t.activeUserMap});case Xt.NEEDS_CATCHUP:var E=t.guids;return Wt({},e,{catchupGuids:ft.a.uniq([].concat(Lt(e.catchupGuids),Lt(E)))});case Xt.DID_CATCHUP:var O=t.guids;return Wt({},e,{catchupGuids:ft.a.difference(e.catchupGuids,O)});case Xt.CLEAR_DIRTY_GUID:var k=Wt({},e.dirtyFlagsCollection);return delete k[t.guid],Wt({},e,{dirtyFlagsCollection:k});default:return e}}},{key:"Actions",get:function(){var e=this;return{update:function(t){var n=e.getState(),r=t.filter(function(e){var t=e.workspace;return null==t||null==t.guid||((n.workspaces[t.guid]||{}).updateSequenceNum||0)<=(t.updateSequenceNum||0)});e.dispatch({type:Xt.UPDATE_WORKSPACES,workspaces:r})},setWorkspaceUserInterfaceProperties:function(t){var n=t.guid,r=t.workspaceUserInterfaceProperties;e.dispatch({type:Xt.SET_WORKSPACE_USER_INTERFACE_PROPERTIES,guid:n,workspaceUserInterfaceProperties:r})},expunge:function(t){e.dispatch({type:Xt.EXPUNGE_WORKSPACES,guids:t})},leave:function(t){var n=gn.getState();(n.workspaceGuidToNotebookGuids.getValuesAsArray(t)||[]).map(function(e){return n.notebooks[e]}).filter(function(e){return null==e.sharedNotebooks}).map(function(e){return e.guid}).forEach(function(e){return gn.Actions.deleteNotebook(e,!1)}),e.dispatch({type:Xt.LEAVE_WORKSPACE,guid:t})},setActiveUsers:function(t){e.dispatch({type:Xt.SET_ACTIVE_MEMBERS,activeUserMap:t})},needsCatchup:function(t){e.dispatch({type:Xt.NEEDS_CATCHUP,guids:t})},didCatchup:function(t){e.dispatch({type:Xt.DID_CATCHUP,guids:t})}}}}]),t}()),Zt=Jt;i.a.register("workspace.actions.getworkspaceresponse",function(){var e=xt(regeneratorRuntime.mark(function e(t){var n,r,o,i,a,u,c,s,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jt.dataSourceInitialized;case 2:return n=Jt.getState(),r=n.accessInfo,o=n.aggregations,i=n.identityByInvitationsGuid,a=n.invitations,u=n.memberships,c=n.notebookGuids,s=n.notebookRestrictions,f=n.workspaceRestrictions,l=n.workspaces,e.abrupt("return",new Ct.WorkspaceResponse({workspace:l[t],invitations:a[t],identityByInvitationsGuid:i[t],memberships:u[t],notebookGuids:c[t],workspaceRestrictions:f[t],aggregations:o[t],notebookRestrictions:s[t],accessInfo:r[t]}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("workspace.actions.getCatchupGuids",xt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jt.dataSourceInitialized;case 2:return e.abrupt("return",Lt(Jt.getState().catchupGuids));case 3:case"end":return e.stop()}},e,this)}))),i.a.register("workspace.actions.getdirty",xt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jt.dataSourceInitialized;case 2:return t=Jt.getState(),e.abrupt("return",Gt(t.workspaces,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("workspace.actions.cleardirty",function(){var e=xt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jt.dataSourceInitialized;case 2:Jt.dispatch({type:Xt.CLEAR_DIRTY_GUID,guid:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("workspace.actions.updateLocal",function(){var e=xt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jt.dataSourceInitialized;case 2:Jt.dispatch({type:Xt.SAVE_WORKSPACE,workspace:t}),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("workspace.actions.leavelocal",function(){var e=xt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jt.dataSourceInitialized;case 2:Jt.Actions.leave(t),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var $t=n(414);function en(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function tn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){en(i,r,o,a,u,"next",e)}function u(e){en(i,r,o,a,u,"throw",e)}a(void 0)})}}function nn(e){return(nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function on(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){an(e,t,n[t])})}return e}function an(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function un(e,t){return!t||"object"!==nn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fn(e,t,n){return t&&sn(e.prototype,t),n&&sn(e,n),e}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pn,dn=Object(a.default)("ion:sugar:Notebook"),bn="SUGAR/NOTEBOOK_DATASOURCE";!function(e){e.UPDATE_NOTEBOOKS="SUGAR/NOTEBOOK/UPDATE_NOTEBOOKS",e.SAVE_NOTEBOOK="SUGAR/NOTEBOOK/SAVE_NOTEBOOK",e.CLEAR_DIRTY_GUID="SUGAR/NOTEBOOK/CLEAR_DIRTY_GUID",e.DELETE_NOTEBOOK_LOCAL="SUGAR/NOTEBOOK/DELETE_NOTEBOOK_LOCAL",e.EXPUNGE_NOTEBOOKS="SUGAR/NOTEBOOK/EXPUNGE_NOTEBOOKS",e.SET_DEFAULT_NOTEBOOK="SUGAR/NOTEBOOK/SET_DEFAULT_NOTEBOOK",e.SET_USER_NOTEBOOK="SUGAR/NOTEBOOK/SET_USER_NOTEBOOK",e.SET_STACK_EXPANDED="SUGAR/NOTEBOOK/SET_STACK_EXPANDED",e.NEEDS_CATCHUP="SUGAR/NOTEBOOK/NEEDS_CATCHUP",e.DID_CATCHUP="SUGAR/NOTEBOOK/DID_CATCHUP"}(pn||(pn={}));var yn={workspaceGuidToNotebookGuids:_t.a.createEmptyMap(),notebookToUpdateInfo:{},notebooks:{},defaultNotebook:null,userNotebook:null,catchupNotebooks:{},dirtyFlagsCollection:{},expandedStacks:new Set},hn=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=un(this,cn(t).call(this,yn,"notebook",bn,!0))).Constants=pn,e.subscribe=function(){var t=i.a.subscribe("notebook",function(t){switch(dn.log("Notebook subscriber ",t),t.type){case"defaultNotebook":return e.Actions.setDefaultNotebook(t.data);case"didCatchup":return e.Actions.didCatchup(t.data);case"expungeNotebook":return e.Actions.expungeNotebooks([t.data]);case"expungeNotebooks":return e.Actions.expungeNotebooks(t.data);case"needsCatchup":return e.Actions.needsCatchup(t.data);case"updateNotebook":var n=t.data,r=n.notebook,o=n.sharedNotebooks;return e.Actions.updateNotebooks({notebooks:[r],sharedNotebooks:o});case"updateNotebooks":var i=t.data,a=i.notebooks,u=i.sharedNotebooks;return e.Actions.updateNotebooks({notebooks:a,sharedNotebooks:u});case"userNotebook":return e.Actions.setUserNotebook(t.data);case"setStackExpanded":return e.Actions.setStackExpanded(t.data.stackName,t.data.expanded)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(t,b),fn(t,[{key:"initialState",get:function(){return yn}}]),fn(t,[{key:"rehydrateState",value:function(e){return on({},e,{workspaceGuidToNotebookGuids:_t.a.createFromSameInstance(e.workspaceGuidToNotebookGuids)})}},{key:"mapInternalToExternalState",value:function(e){var t=e.notebooks,n=e.notebookToUpdateInfo,r=e.workspaceGuidToNotebookGuids,o=e.defaultNotebook,i=e.userNotebook,a=_t.a.createFromSameInstance(r);return{maxUpdatedMap:Object.keys(n).reduce(function(e,t){return e[t]=n[t].lastUpdatedTime,e},{}),notebooks:t,notebookToLastEditedUserIdMap:Object.keys(n).reduce(function(e,t){return e[t]=n[t].lastUpdatedUserId,e},{}),notebookToWorkspaceMap:a.getInwardObject(),defaultNotebook:o,userNotebook:i,workspaceToNotebooksMap:a.getForwardObject(),expandedStacks:rn(e.expandedStacks||new Set)}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case pn.UPDATE_NOTEBOOKS:var n=t.notebooks,r=t.sharedNotebooks,o=on({},e.notebooks),i=ft.a.cloneDeep(e.notebookToUpdateInfo);n.forEach(function(t){if(null!=t.guid){var n=t.guid,r=o[n];if(null!=r){null!=r.isTrueOwner&&null==t.isTrueOwner&&(t.isTrueOwner=r.isTrueOwner),null!=r.isOwnedByMyVaultUser&&null==t.isOwnedByMyVaultUser&&(t.isOwnedByMyVaultUser=r.isOwnedByMyVaultUser),null!=r.shardIdFromSharedAuth&&null==t.shardIdFromSharedAuth&&(t.shardIdFromSharedAuth=r.shardIdFromSharedAuth);var a=e.dirtyFlagsCollection[n];if(a){var u=ft.a.pick(r,Array.from(a));Object.assign(t,u)}}else{var c=e.dirtyFlagsCollection[n];if(c&&c.has("isDeleted"))return}o[n]=t;var s=t&&t.serviceUpdated,f=i[n]&&i[n].lastUpdatedTime;f&&s?i[n]=on({},i[n],{lastUpdatedTime:Math.max(s,f)}):s&&(i[n]=on({},i[n],{lastUpdatedTime:s}))}}),r&&r.forEach(function(e){if(null==e.notebookGuid)throw new Error("".concat(e.notebookGuid," should be present"));var t=o[e.notebookGuid];t&&(null==t.sharedNotebooks&&t.sharedNotebookIds&&t.sharedNotebookIds.length>0?t.sharedNotebooks=[e]:t.sharedNotebooks&&t.sharedNotebookIds&&t.sharedNotebooks.length!==t.sharedNotebookIds.length&&t.sharedNotebooks.push(e),o[e.notebookGuid]=t)});var a=_t.a.createFromSameInstance(e.workspaceGuidToNotebookGuids);n.forEach(function(e){null!=e.workspaceGuid?a.set(e.workspaceGuid,e.guid):a.removeValue(e.guid)});var u=n.find(function(e){return Boolean(e.defaultNotebook||e.recipientSettings&&e.recipientSettings.recipientStatus===Xe.RecipientStatus.IN_MY_LIST_AND_DEFAULT_NOTEBOOK)})||e.defaultNotebook,c=null!=u?on({},u):null,s=null!=e.userNotebook?on({},e.userNotebook):null;return on({},e,{notebooks:o,notebookToUpdateInfo:i,workspaceGuidToNotebookGuids:a,defaultNotebook:c,userNotebook:s,expandedStacks:this.Utils.getFilteredExpandedStacks(e.expandedStacks,o)});case pn.EXPUNGE_NOTEBOOKS:var f=t.guids,l=on({},e.notebooks),p=_t.a.createFromSameInstance(e.workspaceGuidToNotebookGuids),d=on({},e.dirtyFlagsCollection);f.forEach(function(e){p.removeValue(e),delete l[e],delete d[e]});var b=on({},e.catchupNotebooks);return f.forEach(function(e){delete b[e]}),on({},e,{notebooks:l,workspaceGuidToNotebookGuids:p,catchupNotebooks:b,dirtyFlagsCollection:d,expandedStacks:this.Utils.getFilteredExpandedStacks(e.expandedStacks,l)});case pn.DELETE_NOTEBOOK_LOCAL:var y=t.guid,h=t.markDirty,g=on({},e.notebooks);delete g[y];var S=on({},e.dirtyFlagsCollection);return h&&(S[y]=new Set(["isDeleted"])),on({},e,{notebooks:g,dirtyFlagsCollection:S,expandedStacks:this.Utils.getFilteredExpandedStacks(e.expandedStacks,g)});case pn.SAVE_NOTEBOOK:var v=t.changes,m=v.guid,E=v.name,O=v.workspaceGuid;if(null!=E)if(!Ut.a.validateWithoutUnique({name:E}).isValid)throw Error("Notebook name failed validation");var k=on({},e.dirtyFlagsCollection),T=k[m]||new Set;Object.keys(t.changes).forEach(function(e){T.add(e)}),k[m]=T;var w=on({},e.notebooks[m],t.changes),A=on({},e.notebooks,an({},m,w)),_=e.workspaceGuidToNotebookGuids;return void 0!==O&&(_=_t.a.createFromSameInstance(e.workspaceGuidToNotebookGuids),null!=O?_.set(O,m):_.removeValue(m)),on({},e,{notebooks:A,dirtyFlagsCollection:k,workspaceGuidToNotebookGuids:_});case Xt.EXPUNGE_WORKSPACES:var N=t.guids,P=_t.a.createFromSameInstance(e.workspaceGuidToNotebookGuids);return N.forEach(function(e){return P.removeKey(e)}),on({},e,{workspaceGuidToNotebookGuids:P});case Xt.LEAVE_WORKSPACE:var R=t.guid,U=_t.a.createFromSameInstance(e.workspaceGuidToNotebookGuids);return U.removeKey(R),on({},e,{workspaceGuidToNotebookGuids:U});case pn.SET_DEFAULT_NOTEBOOK:var I=t.notebook;return on({},e,{notebooks:on({},e.notebooks,an({},I.guid,I)),defaultNotebook:I});case pn.SET_USER_NOTEBOOK:var C=t.notebook;return on({},e,{notebooks:on({},e.notebooks,an({},C.guid,C)),userNotebook:C});case pn.SET_STACK_EXPANDED:var G=new Set(e.expandedStacks);return t.expanded?G.add(t.stackName):G.delete(t.stackName),on({},e,{expandedStacks:G});case pn.NEEDS_CATCHUP:var j=t.guids,x=t.locator,D=j.reduce(function(e,t){return e[t]={guid:t,personal:x.personal,shard:x.shard,sharedToMe:x.sharedToMe},e},{});return on({},e,{catchupNotebooks:on({},e.catchupNotebooks,D)});case pn.DID_CATCHUP:var L=t.guids,K=on({},e.catchupNotebooks);return L.forEach(function(e){delete K[e]}),on({},e,{catchupNotebooks:K});case zn.UPDATE_NOTES:var F=on({},e.notebookToUpdateInfo),B=t.notes.reduce(function(t,n){var r=n.notebookGuid,o=n.updated;if(null==r)return t;var i=e.notebooks[r],a=i&&i.serviceUpdated,u=t[r]&&t[r].lastUpdatedTime;return null==u&&(t[r]={lastUpdatedTime:a,lastUpdatedUserId:null},u=a),u&&o&&o>u&&(t[r].lastUpdatedTime=o,t[r].lastUpdatedUserId=n.attributes?n.attributes.lastEditorId:null),t},F);return on({},e,{notebookToUpdateInfo:B});case pn.CLEAR_DIRTY_GUID:var M=on({},e.dirtyFlagsCollection);return delete M[t.guid],on({},e,{dirtyFlagsCollection:M});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateNotebooks:function(t){var n=t.notebooks,r=t.sharedNotebooks,o=e.getState().notebooks,i=n.filter(function(e){return((o[e.guid]||{}).updateSequenceNum||0)<=(e.updateSequenceNum||0)});e.dispatch({type:pn.UPDATE_NOTEBOOKS,notebooks:i,sharedNotebooks:r})},expungeNotebooks:function(t){e.dispatch({type:pn.EXPUNGE_NOTEBOOKS,guids:t}),t.length>0&&Object($t.e)(t)},deleteNotebook:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.getState(),o=r.notebooks,i=r.defaultNotebook,a=o[t].isTrueOwner;if(a&&(!i||i.guid===t))throw Error("User is attempting to delete a notebook without a valid fallback notebook.");var u=a&&i&&i.guid;e.dispatch({type:pn.DELETE_NOTEBOOK_LOCAL,guid:t,notebookGuidForSalvagedNotes:u,markDirty:n})},saveNotebook:function(t){e.dispatch({type:pn.SAVE_NOTEBOOK,changes:t})},setDefaultNotebook:function(t){e.dispatch({type:pn.SET_DEFAULT_NOTEBOOK,notebook:t})},setUserNotebook:function(t){e.dispatch({type:pn.SET_USER_NOTEBOOK,notebook:t})},setStackExpanded:function(t,n){e.dispatch({type:pn.SET_STACK_EXPANDED,stackName:t,expanded:n})},needsCatchup:function(t){var n=t.guids,r=void 0===n?[]:n,o=t.locator;e.dispatch({type:pn.NEEDS_CATCHUP,guids:r,locator:o})},didCatchup:function(t){e.dispatch({type:pn.DID_CATCHUP,guids:t})}}}},{key:"Utils",get:function(){return{validateName:Ut.a.validationWithoutUnique.name,getFilteredExpandedStacks:function(e,t){var n={};Object.keys(t).forEach(function(e){var r=t[e];r.recipientSettings&&r.recipientSettings.stack&&(n[r.recipientSettings.stack]?n[r.recipientSettings.stack].push(e):n[r.recipientSettings.stack]=[e])});var r=Array.from(e);return new Set(r.filter(function(e){return Object.prototype.hasOwnProperty.call(n,e)}))}}}}]),t}()),gn=hn;function Sn(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function vn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Sn(i,r,o,a,u,"next",e)}function u(e){Sn(i,r,o,a,u,"throw",e)}a(void 0)})}}function mn(e){return(mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function En(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){On(e,t,n[t])})}return e}function On(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kn(e,t){return!t||"object"!==mn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tn(e){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function An(e,t,n){return t&&wn(e.prototype,t),n&&wn(e,n),e}function _n(e,t){return(_n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("notebook.actions.getparentworkspace",function(e){return new Promise(function(t){hn.dataSourceInitialized.then(function(){var n=(hn.getState().notebooks[e]||{}).workspaceGuid;n?i.a.call("workspace.actions.getworkspaceresponse",n).then(function(e){t(e.workspace)}).catch(function(){t(null)}):t(null)})})}),i.a.register("notebook.actions.getnotebook",function(){var e=tn(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("guid is requires for getNotebook call");case 2:return e.next=4,hn.dataSourceInitialized;case 4:if(n=hn.getState(),r=n.notebooks[t]){e.next=8;break}return e.abrupt("return");case 8:return o=n.dirtyFlagsCollection[t]||new Set,e.abrupt("return",on({},r,{dirtyFlags:o}));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.hasnotebook",function(){var e=tn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t in(hn.getState().notebooks||{}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.updatelocal",function(){var e=tn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:hn.dispatch({type:pn.SAVE_NOTEBOOK,changes:t}),i.a.publish("sync.notes");case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.expungeNotebookLocal",function(){var e=tn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn.dataSourceInitialized;case 2:hn.Actions.deleteNotebook(t),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.hasnotebooks",function(){var e=tn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ft.a.difference(t,Object.keys(hn.getState().notebooks||{})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.notebooksinworkspaces",tn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=hn.mapInternalToExternalState(hn.getState()),e.abrupt("return",t.notebookToWorkspaceMap);case 2:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.getCatchupNotebooks",tn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn.dataSourceInitialized;case 2:return e.abrupt("return",Object.values(hn.getState().catchupNotebooks));case 3:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.getWorkspaceToNotebookGuids",tn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn.dataSourceInitialized;case 2:return e.abrupt("return",hn.getState().workspaceGuidToNotebookGuids);case 3:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.getdirty",tn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn.dataSourceInitialized;case 2:return t=hn.getState(),e.abrupt("return",Gt(t.notebooks,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.cleardirty",function(){var e=tn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn.dataSourceInitialized;case 2:hn.dispatch({type:pn.CLEAR_DIRTY_GUID,guid:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Nn=Object(a.default)("ion:sugar:Tag"),Pn="SUGAR/TAG_DATASOURCE",Rn={CLEAR_DIRTY:"SUGAR/TAG/CLEAR_DIRTY",DELETE_TAGS:"SUGAR/TAG/DELETE_TAGS",DELETE_TAG_LOCAL:"SUGAR/TAG/DELETE_TAG_LOCAL",UPDATE_TAGS:"SUGAR/TAG/UPDATE_TAGS",UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID:"SUGAR/TAG/UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID",SHARED_TAGS_COUNT_BY_NAME:"SUGAR/TAG/SHARED_TAGS_COUNT_BY_NAME",UPDATE_SHARED_TAGS_BY_NOTEBOOK:"SUGAR/TAG/UPDATE_SHARED_TAGS_BY_NOTEBOOK"},Un={tags:{},bootstrapTagCountsByGuid:{},tagsBySharedNotebookGuid:{},sharedNotebookTagCountsByName:{},dirtyFlagsCollection:{}},In=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=kn(this,Tn(t).call(this,Un,"tag",Pn,!0))).subscribe=function(){var t=i.a.subscribe("tag",function(t){switch(Nn.log("Tag subscriber ",t),t.type){case"updateTag":return e.Actions.updateTags([t.data]);case"updateTags":return e.Actions.updateTags(t.data);case"deleteTag":return e.Actions.deleteTags([t.data]);case"deleteTags":return e.Actions.deleteTags(t.data);case"countTag":return e.Actions.updateBootstrapTagCountsByGuid(t.data);case"updateSharedTags":return e.Actions.updateSharedTags(t.data);case"countSharedTags":return e.Actions.updateSharedTagsCountByName(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_n(e,t)}(t,b),An(t,[{key:"initialState",get:function(){return Un}},{key:"Constants",get:function(){return Rn}}]),An(t,[{key:"mapInternalToExternalState",value:function(e){return{tags:e.tags,bootstrapTagCountsByGuid:e.bootstrapTagCountsByGuid,tagsBySharedNotebookGuid:e.tagsBySharedNotebookGuid,sharedNotebookTagCountsByName:e.sharedNotebookTagCountsByName}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Rn.DELETE_TAGS:var n=t.guids,r=En({},e.tags);return n.reduce(function(e,t){return delete e[t],e},r),Object.values(r).forEach(function(e){n.includes(e.parentGuid||"")&&(r[e.guid].parentGuid=null)}),En({},e,{tags:r});case Rn.DELETE_TAG_LOCAL:var o=t.guid,i=En({},e.tags),a=En({},e.dirtyFlagsCollection);return delete i[o],a[o]=new Set(["isDeleted"]),En({},e,{tags:i,dirtyFlagsCollection:a});case Rn.CLEAR_DIRTY:var u=t.guid,c=En({},e.dirtyFlagsCollection);return delete c[u],En({},e,{dirtyFlagsCollection:c});case Rn.UPDATE_TAGS:var s=t.tags,f=En({},e.tags);return s.reduce(function(e,t){var n=t.guid,r=t.name;if(null==n||null==r)return e;var o=En({},e[n]||{},t,{guid:n,name:r});return e[n]=o,e},f),En({},e,{tags:f});case Rn.UPDATE_SHARED_TAGS_BY_NOTEBOOK:var l=t.tags,p=t.notebookGuid,d=En({},e.tagsBySharedNotebookGuid[p]);return d=l.reduce(function(e,t){var n=t.guid,r=t.name;if(null==n||null==r)return e;var o=En({},e[n]||{},t,{guid:n,name:r});return e[n]=o,e},d),En({},e,{tagsBySharedNotebookGuid:En({},e.tagsBySharedNotebookGuid,On({},p,d))});case Rn.UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID:var b=t.noteCollection;return null==b.tagCounts?e:En({},e,{bootstrapTagCountsByGuid:En({},b.tagCounts)});case Rn.SHARED_TAGS_COUNT_BY_NAME:var y=t.noteCollection,h=t.notebookGuid,g=En({},e.tagsBySharedNotebookGuid[h]),S={};return Object.keys(y.tagCounts||{}).forEach(function(e){S[g[e].name]=y.tagCounts&&y.tagCounts[e]||0}),En({},e,{sharedNotebookTagCountsByName:En({},e.sharedNotebookTagCountsByName,On({},h,S))});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateTags:function(t){e.dispatch({type:Rn.UPDATE_TAGS,tags:t})},updateBootstrapTagCountsByGuid:function(t){e.dispatch({type:Rn.UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID,noteCollection:t})},deleteTags:function(t){e.dispatch({type:Rn.DELETE_TAGS,guids:t})},updateSharedTags:function(t){var n=t.tags,r=t.guid;e.dispatch({type:Rn.UPDATE_SHARED_TAGS_BY_NOTEBOOK,tags:n,notebookGuid:r})},updateSharedTagsCountByName:function(t){var n=t.noteCollection,r=t.notebookGuid;e.dispatch({type:Rn.SHARED_TAGS_COUNT_BY_NAME,noteCollection:n,notebookGuid:r})}}}},{key:"Utils",get:function(){return{validateName:Ut.b.validation.name}}}]),t}()),Cn=In;function Gn(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function jn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Gn(i,r,o,a,u,"next",e)}function u(e){Gn(i,r,o,a,u,"throw",e)}a(void 0)})}}function xn(e){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Kn(e,t,n[t])})}return e}function Kn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fn(e,t){return!t||"object"!==xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bn(e){return(Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vn(e,t,n){return t&&Mn(e.prototype,t),n&&Mn(e,n),e}function Hn(e,t){return(Hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("tag.actions.getdirty",vn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In.dataSourceInitialized;case 2:return t=In.getState(),e.abrupt("return",Gt(t.tags,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("tag.actions.deleteLocal",function(){var e=vn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In.dataSourceInitialized;case 2:In.dispatch({type:Rn.DELETE_TAG_LOCAL,guid:t}),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("tag.actions.cleardirty",function(){var e=vn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,In.dataSourceInitialized;case 2:In.dispatch({type:Rn.CLEAR_DIRTY,guid:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Wn,zn,Xn=Object(a.default)("ion:sugar:Note"),Yn=Object(a.default)("ceReloadDebug:sugar"),qn="SUGAR/NOTE_DATASOURCE";!function(e){e.NO_CONTAINER="NOTE_REMOVING_RULES/NO_CONTAINER"}(Wn||(Wn={})),function(e){e.UPDATE_NOTES="SUGAR/NOTE/UPDATE_NOTES",e.EXPUNGE_NOTES="SUGAR/NOTE/EXPUNGE_NOTES",e.DELETE_LOCAL="SUGAR/NOTE/DELETE_LOCAL",e.SELECT_NOTE="SUGAR/NOTE/SELECT_NOTE",e.CLEAR_DIRTY="SUGAR/NOTE/CLEAR_DIRTY",e.UPDATE_LOCK="SUGAR/NOTE/UPDATE_LOCK"}(zn||(zn={}));var Qn={accessibleNotebookGuids:[],notebookGuidToNoteGuids:_t.a.createEmptyMap(),notes:{},selectedNotes:{},dirtyFlagsCollection:{},locks:{},nextNotesDiff:{}},Jn=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Fn(this,Bn(t).call(this,Qn,"note",qn,!0))).Constants=zn,e.subscribe=function(){var t=i.a.subscribe("note",function(t){switch(t.type){case"updateNote":return e.Actions.updateNotes([t.data.note],t.data.resultSpec,t.data.locator);case"updateNotes":return e.Actions.updateNotes(t.data.notes,t.data.resultSpec,t.data.locator);case"expungeNote":return e.Actions.expungeNotes([t.data]);case"expungeNotes":return e.Actions.expungeNotes(t.data);case"expungeNotesNoLongerSharedWithMe":return e.Actions.expungeNotesSelectively(t.data.noteGuids,Wn.NO_CONTAINER);case"selectNote":return e.Actions.selectNote(t.data.guid,t.data.windowId);case"updateLock":return e.Actions.updateLock(t.data.guid,t.data.lockState)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hn(e,t)}(t,b),Vn(t,[{key:"initialState",get:function(){return Qn}}]),Vn(t,[{key:"rehydrateState",value:function(e){return Ln({},e,{notebookGuidToNoteGuids:_t.a.createFromSameInstance(e.notebookGuidToNoteGuids)})}},{key:"mapInternalToExternalState",value:function(e){return{dirtyGuids:Object.keys(e.dirtyFlagsCollection),locks:e.locks,nextNotesDiff:e.nextNotesDiff}}},{key:"saveState",value:function(e){var t=e.accessibleNotebookGuids,n=e.notebookGuidToNoteGuids,i=Ln({},e.notes);"web"===Rt.a.platformName&&Object.values(e.selectedNotes).forEach(function(e){var t=i[e];t&&(i[e]=Ln({},t,{content:null}))});var a=Ln({},Qn,{accessibleNotebookGuids:t,notebookGuidToNoteGuids:n,notes:i});return r.default.set(Object(o.a)(this.namespace),this.getPersistenceName(),a)}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case zn.UPDATE_NOTES:var n=t.notes,r=t.resultSpec,o=Ln({},e.notes),i={};n.forEach(function(t){var n=e.notes[t.guid]||{},a=Ln({},n,t),u=n.updateSequenceNum||0,c=t.updateSequenceNum||0,s=e.dirtyFlagsCollection[a.guid];s&&s.has("isDeleted")||(null!=t.content||r.includeContent||(a.content=n.content||null,n.content&&!ft.a.isEqual(t.contentHash,n.contentHash)&&u<c&&(Yn.trace("marking note guid=(".concat(a.guid,") as STALE")),a.stale=!0)),!t.content&&n.content||(Yn.log("marking note guid=(".concat(a.guid,") as NOT STALE")),a.stale=!1),null!=t.sharedNotes||r.includeSharedNotes||(a.sharedNotes=n.sharedNotes||null),null!=t.resources||r.includeContent||(a.resources=n.resources||null),null!=t.limits||r.includeAccountLimits||(a.limits=n.limits||null),null==a.contentHash&&(a.contentHash=n.contentHash||null),null==a.contentLength&&(a.contentLength=n.contentLength||null),o[t.guid]=a,i[t.guid]=a)});var a=_t.a.createFromSameInstance(e.notebookGuidToNoteGuids);return n.filter(function(t){return e.accessibleNotebookGuids.includes(t.notebookGuid)}).forEach(function(e){a.set(e.notebookGuid,e.guid)}),Ln({},e,{notebookGuidToNoteGuids:a,notes:o,nextNotesDiff:i});case pn.UPDATE_NOTEBOOKS:var u=t.notebooks.map(function(e){return e.guid}).filter(function(t){return!e.accessibleNotebookGuids.includes(t)}).concat(e.accessibleNotebookGuids),c=_t.a.createFromSameInstance(e.notebookGuidToNoteGuids);return Object.keys(e.notes).map(function(t){return e.notes[t]}).forEach(function(e){u.includes(e.notebookGuid)&&c.set(e.notebookGuid,e.guid)}),Ln({},e,{accessibleNotebookGuids:u,notebookGuidToNoteGuids:c,nextNotesDiff:{}});case pn.EXPUNGE_NOTEBOOKS:var s=t.guids,f=e.accessibleNotebookGuids.filter(function(e){return!s.includes(e)}),l=_t.a.createFromSameInstance(e.notebookGuidToNoteGuids),p={},d=ft.a.flatMap(s,function(e){return l.getValuesAsArray(e)||[]}).map(function(t){return e.notes[t]}).filter(Pt.isNoteExpungeableWithoutContainerNotebook).map(function(e){return e.guid}).reduce(function(e,t){return delete e[t],p[t]=null,e},Ln({},e.notes));return s.forEach(function(e){l.removeKey(e)}),Ln({},e,{accessibleNotebookGuids:f,notebookGuidToNoteGuids:l,notes:d,nextNotesDiff:p});case Rn.DELETE_TAG_LOCAL:var b=t.guid,y=Ln({},e.notes),h={};return Object.keys(y).forEach(function(e){var t=y[e];if(t.tagGuids){var n=t.tagGuids.indexOf(b);if(n>=0){var r=Dn(t.tagGuids);r.splice(n,1),y[e]=Ln({},t,{tagGuids:r}),h[e]=y[e]}}}),Ln({},e,{notes:y,nextNotesDiff:h});case pn.DELETE_NOTEBOOK_LOCAL:var g=t.guid,S=t.notebookGuidForSalvagedNotes,v=e.notebookGuidToNoteGuids.getValuesAsArray(g);if(!v)return e;var m=Ln({},e.notes),E=_t.a.createFromSameInstance(e.notebookGuidToNoteGuids);E.removeKey(g);var O={};return v.forEach(function(e){S&&null!=m[e]?(m[e]=Ln({},m[e],{active:!1,notebookGuid:S}),O[e]=m[e],E.set(S,e)):(O[e]=null,delete m[e])}),Ln({},e,{notes:m,notebookGuidToNoteGuids:E,nextNotesDiff:O});case zn.EXPUNGE_NOTES:var k,T=t.guids,w=t.predicate,A=_t.a.createFromSameInstance(e.notebookGuidToNoteGuids);switch(w){case Wn.NO_CONTAINER:k=function(e){return!!e&&!A.hasValue(e.guid)};break;default:k=function(e){return!!e}}var _=T.map(function(t){return e.notes[t]}).filter(k).map(function(e){return e.guid}),N={},P=_.reduce(function(e,t){return delete e[t],N[t]=null,e},Ln({},e.notes));return _.forEach(function(e){A.removeValue(e)}),Ln({},e,{notebookGuidToNoteGuids:A,notes:P,nextNotesDiff:N});case zn.DELETE_LOCAL:var R=t.guids,U=_t.a.createFromSameInstance(e.notebookGuidToNoteGuids),I={},C=R.reduce(function(e,t){return delete e[t],I[t]=null,e},Ln({},e.notes)),G=Ln({},e.dirtyFlagsCollection);return R.forEach(function(e){U.removeValue(e),G[e]=new Set(["isDeleted"])}),Ln({},e,{notebookGuidToNoteGuids:U,notes:C,dirtyFlagsCollection:G,nextNotesDiff:I});case zn.SELECT_NOTE:var j=t.guid,x=t.windowId,D=void 0===x?"default":x,L=e.selectedNotes[D],K=e.locks||{};if(L===j)return e;var F=Ln({},e.selectedNotes,Kn({},D,j)),B=Object.keys(F).map(function(e){return F[e]}),M=ft.a.difference(Object.keys(K),B).reduce(function(e,t){return delete e[t],e},K);return j&&null==M[j]&&(M[j]=this.Utils.getInitialLockState()),Ln({},e,{selectedNotes:F,locks:M,nextNotesDiff:{}});case zn.UPDATE_LOCK:var V=t.guid,H=t.lockState,W=Ln({},e.locks);return W[V]=Ln({},this.Utils.getInitialLockState(),W[V],H),Ln({},e,{locks:W,nextNotesDiff:{}});case zn.CLEAR_DIRTY:var z=Ln({},e.dirtyFlagsCollection);return t.guids.forEach(function(e){delete z[e]}),Ln({},e,{dirtyFlagsCollection:z,nextNotesDiff:{}});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateNotes:function(t,n,r){var o=n||new At.NoteResultSpec;if(null==r){var i=new Error("locator was unexpectedly null in updateNotes");throw Xn.error(i),i}var a=o.includeContent?t.map(function(e){return Ln({},e,{_marshalledResources:Object(Nt.createResourceMap)(e,r)})}):t,u=e.getState().notes,c=a.filter(function(e){return((u[e.guid]||{}).updateSequenceNum||0)<=(e.updateSequenceNum||0)});e.dispatch({type:zn.UPDATE_NOTES,notes:c,resultSpec:o})},expungeNotes:function(t){e.dispatch({type:zn.EXPUNGE_NOTES,guids:t})},expungeNotesSelectively:function(t,n){e.dispatch({type:zn.EXPUNGE_NOTES,guids:t,predicate:n})},selectNote:function(t,n){e.dispatch({type:zn.SELECT_NOTE,guid:t,windowId:n})},updateLock:function(t,n){e.dispatch({type:zn.UPDATE_LOCK,guid:t,lockState:n})}}}},{key:"Utils",get:function(){return{getInitialLockState:function(){return{hasLock:!1,isAcquiringLock:!1,isLockAvailable:!1}}}}}]),t}()),Zn=Jn;i.a.register("note.datasource.getnote",function(e){return new Promise(function(t,n){Jn.dataSourceInitialized.then(function(){var n=Jn.getState().notes[e]||null;t(n)}).catch(function(e){n(e)})})}),i.a.register("note.datasource.getselectedguids",jn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.dataSourceInitialized;case 2:return e.abrupt("return",ft.a.uniq(Object.values(Jn.getState().selectedNotes||{})));case 3:case"end":return e.stop()}},e,this)}))),i.a.register("note.actions.getall",function(){return new Promise(function(e){Jn.dataSourceInitialized.then(function(){e(Jn.getState().notes)})})}),i.a.register("note.actions.getdirty",jn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.dataSourceInitialized;case 2:return t=Jn.getState(),e.abrupt("return",Gt(t.notes,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("note.actions.cleardirty",function(){var e=jn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.dataSourceInitialized;case 2:Jn.dispatch({type:zn.CLEAR_DIRTY,guids:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("note.actions.expungeNotesLocal",function(){var e=jn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.dataSourceInitialized;case 2:Jn.dispatch({type:zn.DELETE_LOCAL,guids:t}),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var $n=n(371);function er(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function tr(e){return(tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nr(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function rr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){or(e,t,n[t])})}return e}function or(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ir(e,t){return!t||"object"!==tr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ar(e){return(ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cr(e,t,n){return t&&ur(e.prototype,t),n&&ur(e,n),e}function sr(e,t){return(sr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fr,lr="SUGAR/PREFERENCE_DATASOURCE";!function(e){e.UPDATE_PREFERENCES="SUGAR/PREFERENCES/UPDATE_PREFERENCES",e.UPDATE_SHORTCUT_EXPANSION="SUGAR/PREFERENCES/UPDATE_SHORTCUT_EXPANSION",e.UPDATE_STACK_SHORTCUT_EXPANSION="SUGAR/PREFERENCES/UPDATE_STACK_SHORTCUT_EXPANSION"}(fr||(fr={}));var pr={shortcuts:{shortcutsArray:[],expanded:!1,expandedStacks:new Set}},dr=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ir(this,ar(t).call(this,pr,"preference",lr,!0))).subscribe=function(){var t=i.a.subscribe("preference",function(t){switch(t.type){case"updatePreferences":return e.Actions.updatePreferences(t.data);case"updateShortcutsExpanded":return e.Actions.updateShortcutsExpanded(t.data);case"updateStackShortcutExpanded":return e.Actions.updateStackShortcutExpanded(t.data.stackName,t.data.expanded)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sr(e,t)}(t,b),cr(t,[{key:"initialState",get:function(){return pr}},{key:"Constants",get:function(){return fr}}]),cr(t,[{key:"mapInternalToExternalState",value:function(e){return{shortcuts:this.Utils.parsePreferenceShortcuts(e.shortcuts)}}},{key:"reducer",value:function(e,t){switch(t.type){case fr.UPDATE_PREFERENCES:var n=t.preferences["evernote.shortcuts"]||[],r=this.Utils.getStackShortcuts(n),o=this.Utils.getExpandedStackShortcuts(e.shortcuts);return rr({},e,{shortcuts:rr({},e.shortcuts,{shortcutsArray:n,expandedStacks:new Set(o.filter(function(e){return r.includes(e)}))})});case fr.UPDATE_SHORTCUT_EXPANSION:return rr({},e,{shortcuts:rr({},e.shortcuts,{expanded:t.expanded})});case fr.UPDATE_STACK_SHORTCUT_EXPANSION:var i=new Set(e.shortcuts.expandedStacks);return t.expanded?i.add(t.stackName):i.delete(t.stackName),rr({},e,{shortcuts:rr({},e.shortcuts,{expandedStacks:i})});default:return e}}},{key:"Actions",get:function(){var e=this;return{updatePreferences:function(t){e.dispatch({type:fr.UPDATE_PREFERENCES,preferences:t.preferences||{}})},updateShortcutsExpanded:function(t){e.dispatch({type:fr.UPDATE_SHORTCUT_EXPANSION,expanded:t})},updateStackShortcutExpanded:function(t,n){e.dispatch({type:fr.UPDATE_STACK_SHORTCUT_EXPANSION,stackName:t,expanded:n})}}}},{key:"Utils",get:function(){var e=this;return{parsePreferenceShortcuts:function(t){var n=t.shortcutsArray;if(0===n.length)return{updated:null,shortcuts:[],expanded:e.Utils.getExpanded(t),expandedStacks:e.Utils.getExpandedStackShortcuts(t)};var r=JSON.parse(n[0]).updated,o=[];return ft.a.forEach(n.slice(1),function(e){var t=JSON.parse(e),n=t[0];switch(n){case"Note":o.push({type:n,noteGuid:t[1]});break;case"Notebook":o.push({type:n,notebookGuid:t[1]});break;case"Stack":o.push({type:n,stackName:t[1]});break;case"SavedSearch":$n.a.isSearchV4Enabled()&&o.push({type:n,savedSearchID:t[1]})}}),{updated:r,shortcuts:o,expanded:e.Utils.getExpanded(t),expandedStacks:e.Utils.getExpandedStackShortcuts(t)}},getStackShortcuts:function(e){return e.slice(1).reduce(function(e,t){var n=JSON.parse(t);return"Stack"===n[0]&&e.push(n[1]),e},[])},getExpanded:function(e){return e.expanded||!1},getExpandedStackShortcuts:function(e){return nr(e.expandedStacks||new Set)}}}}]),t}()),br=dr;function yr(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function hr(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){yr(i,r,o,a,u,"next",e)}function u(e){yr(i,r,o,a,u,"throw",e)}a(void 0)})}}function gr(e){return(gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function vr(e){var t=function(e,t){if("object"!==gr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==gr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===gr(t)?t:String(t)}function mr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Er(e,t,n[t])})}return e}function Er(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Or(e,t){return!t||"object"!==gr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function kr(e){return(kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wr(e,t,n){return t&&Tr(e.prototype,t),n&&Tr(e,n),e}function Ar(e,t){return(Ar=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("preference.actions.getshortcutsarray",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){er(i,r,o,a,u,"next",e)}function u(e){er(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dr.dataSourceInitialized;case 2:return e.abrupt("return",dr.getState().shortcuts.shortcutsArray);case 3:case"end":return e.stop()}},e,this)})));var _r,Nr="SUGAR/PROFILE_DATASOURCE";!function(e){e.SET_PROFILES="SUGAR/PROFILES/SET_PROFILES",e.SET_USERS_UPDATE_COUNT="SUGAR/PROFILES/SET_USERS_UPDATE_COUNT",e.USER_TO_PROFILE="SUGAR/PROFILES/USER_TO_PROFILE"}(_r||(_r={}));var Pr={businessUsersUpdateCount:-1,profiles:{}},Rr=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Or(this,kr(t).call(this,Pr,"profile",Nr,!0))).subscribe=function(){var t=i.a.subscribe("profile",function(t){switch(t.type){case"set":return e.Actions.set(t.data);case"setbusinessusersupdatecount":return e.Actions.setBusinessUsersUpdateCount(t.data)}}),n=i.a.subscribe("user",function(t){switch(t.type){case"update":return e.Actions.userToProfile(t.data)}});e.unsubscribeFns=[t,n]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ar(e,t)}(t,b),wr(t,[{key:"initialState",get:function(){return Pr}},{key:"Constants",get:function(){return _r}}]),wr(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case _r.SET_USERS_UPDATE_COUNT:return mr({},e,{businessUsersUpdateCount:t.businessUsersUpdateCount});case _r.SET_PROFILES:return mr({},e,{profiles:mr({},t.profiles)});case _r.USER_TO_PROFILE:var n=t.user.id;if(null==n)return e;var r=e.profiles,o=r[n],i=Sr(r,[n].map(vr)),a=Sr(e,["profiles"]),u=new Xe.UserProfile(o);return u.id=n,u.name=t.user.name||t.user.email,u.email=t.user.email,u.username=t.user.username,u.photoLastUpdated=t.user.photoLastUpdated,u.photoUrl=t.user.photoUrl,mr({},a,{profiles:mr({},i,Er({},n,u))});default:return e}}},{key:"Actions",get:function(){var e=this;return{set:function(t){e.dispatch({type:_r.SET_PROFILES,profiles:t})},userToProfile:function(t){e.dispatch({type:_r.USER_TO_PROFILE,user:t})},setBusinessUsersUpdateCount:function(t){e.dispatch({type:_r.SET_USERS_UPDATE_COUNT,businessUsersUpdateCount:t})}}}},{key:"Utils",get:function(){return{}}}]),t}()),Ur=Rr;function Ir(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function Cr(e){return(Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jr(e,t){return!t||"object"!==Cr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xr(e){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lr(e,t,n){return t&&Dr(e.prototype,t),n&&Dr(e,n),e}function Kr(e,t){return(Kr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("profile.actions.getprofiles",hr(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rr.dataSourceInitialized;case 2:return e.abrupt("return",Rr.getState().profiles);case 3:case"end":return e.stop()}},e,this)}))),i.a.register("profile.actions.getbusinessusersupdatecount",hr(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rr.dataSourceInitialized;case 2:return e.abrupt("return",Rr.getState().businessUsersUpdateCount);case 3:case"end":return e.stop()}},e,this)})));var Fr,Br="SUGAR/QUICK_SWITCHER_DATASOURCE";(Fr||(Fr={})).SET_RECENT_QUERIES="SUGAR/QUICK_SWITCHER/SET_RECENT_QUERIES";var Mr={recentQueries:[]},Vr=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=jr(this,xr(t).call(this,Mr,"quickswitcher",Br,!0))).subscribe=function(){var t=i.a.subscribe("quickswitcher",function(t){switch(t.type){case"set":return e.Actions.setRecentQueries(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kr(e,t)}(t,b),Lr(t,[{key:"initialState",get:function(){return Mr}},{key:"Constants",get:function(){return Fr}}]),Lr(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Fr.SET_RECENT_QUERIES:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Gr(e,t,n[t])})}return e}({},e,{recentQueries:t.recentQueries});default:return e}}},{key:"Actions",get:function(){var e=this;return{getRecentQueries:function(){return e.getState().recentQueries},setRecentQueries:function(t){e.dispatch({type:Fr.SET_RECENT_QUERIES,recentQueries:t})}}}}]),t}()),Hr=Vr;function Wr(e){return(Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zr(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function Xr(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){qr(e,t,n[t])})}return e}function qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qr(e,t){return!t||"object"!==Wr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Jr(e){return(Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $r(e,t,n){return t&&Zr(e.prototype,t),n&&Zr(e,n),e}function eo(e,t){return(eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("quickswitcher.actions.getrecentqueries",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ir(i,r,o,a,u,"next",e)}function u(e){Ir(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Vr.Actions.getRecentQueries());case 1:case"end":return e.stop()}},e,this)}))),i.a.register("quickswitcher.actions.setrecentqueries",function(e){return Vr.Actions.setRecentQueries(e),Promise.resolve()});var to="SUGAR/SEARCH_DATASOURCE",no={EXECUTE_SEARCH_SERVICE:"SUGAR/SEARCH/EXECUTE_SEARCH_SERVICE"},ro={results:null},oo=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Qr(this,Jr(t).call(this,ro,"search",to,!0))).Constants=no,e.subscribe=function(){var t=i.a.subscribe("search",function(t){switch(t.type){case"findnotes":return e.Actions.findNotes(t.data.filter,t.data.errCb)}}),n=i.a.subscribe("service.search",function(t){switch(t.type){case"fillresults":return e.Actions.fillWithResults(t.data)}});e.unsubscribeFns=[t,n]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&eo(e,t)}(t,b),$r(t,[{key:"initialState",get:function(){return ro}}]),$r(t,[{key:"mapInternalToExternalState",value:function(e){return e.results}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case no.EXECUTE_SEARCH_SERVICE:if(null==t.results.startIndex||null==t.results.notes||null==e.results||null==e.results.notes||!ft.a.isEqual(e.results.searchedWords,t.results.searchedWords)||!ft.a.isEqual(e.results.stoppedWords,t.results.stoppedWords))return Yr({},e,{results:t.results});var n=t.results.startIndex,r=t.results.notes,o=ft.a.cloneDeep(e.results.notes||[]);return o.splice.apply(o,[n,r.length].concat(Xr(r))),0===o.length?Yr({},e,{results:t.results}):Yr({},e,{results:Yr({},t.results,{notes:o})});default:return e}}},{key:"Actions",get:function(){var e=this;return{findNotes:function(t,n){e.dataSourceReady.then(function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){zr(i,r,o,a,u,"next",e)}function u(e){zr(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.a.call("note.actions.findNotesMetadata",{filter:t});case 1:case"end":return e.stop()}},e,this)}))).catch(n())},fillWithResults:function(t){e.dispatch({type:no.EXECUTE_SEARCH_SERVICE,results:t})}}}},{key:"Utils",get:function(){return{validateName:Ut.a.validationWithoutUnique.name}}}]),t}());function io(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function ao(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){io(i,r,o,a,u,"next",e)}function u(e){io(i,r,o,a,u,"throw",e)}a(void 0)})}}function uo(e){return(uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function co(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){so(e,t,n[t])})}return e}function so(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fo(e,t){return!t||"object"!==uo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lo(e){return(lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function po(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bo(e,t,n){return t&&po(e.prototype,t),n&&po(e,n),e}function yo(e,t){return(yo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ho,go=Object(a.default)("ion:sugar:survey");(ho||(ho={})).SET_QUALTRICS_PROMOTIONS="SUGAR/SURVEY/SET_QUALTRICS_PROMOTIONS";var So="SUGAR/SURVEY_DATASOURCE",vo={qualtricsPromotions:{}},mo=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=fo(this,lo(t).call(this,vo,"survey",So,!0))).subscribe=function(){var t=i.a.subscribe("survey",function(t){switch(go.log("Qualtrics subscribe",t),t.type){case"setQualtricsPromotions":return e.Actions.setQualtricsPromotions(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yo(e,t)}(t,b),bo(t,[{key:"initialState",get:function(){return vo}},{key:"Constants",get:function(){return ho}}]),bo(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case ho.SET_QUALTRICS_PROMOTIONS:var n=t.surveys;return co({},e,{qualtricsPromotions:co({},e.qualtricsPromotions,n)});default:return e}}},{key:"Actions",get:function(){var e=this;return{setQualtricsPromotions:function(t){e.dispatch({type:ho.SET_QUALTRICS_PROMOTIONS,surveys:t})}}}}]),t}()),Eo=mo;i.a.register("survey.actions.hasPromotions",ao(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!ft.a.isEmpty(mo.getState().qualtricsPromotions));case 1:case"end":return e.stop()}},e,this)}))),i.a.register("survey.actions.getQualtricsPromotions",ao(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mo.getState().qualtricsPromotions);case 1:case"end":return e.stop()}},e,this)})));var Oo=n(482);function ko(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function To(e){return(To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ao(e,t,n[t])})}return e}function Ao(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _o(e,t){return!t||"object"!==To(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function No(e){return(No=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Po(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ro(e,t,n){return t&&Po(e.prototype,t),n&&Po(e,n),e}function Uo(e,t){return(Uo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Io,Co=Object(a.default)("ion:sugar:Task"),Go="SUGAR/TASK_DATASOURCE";!function(e){e.EXPUNGE_TASKS="SUGAR/TASK/EXPUNGE_TASKS",e.UPDATE_TASKS="SUGAR/TASK/UPDATE_TASKS",e.SET_TASK_GROUP="SUGAR/TASK/SET_TASK_GROUP",e.SET_TASK_VIEW="SUGAR/TASK/SET_TASK_VIEW"}(Io||(Io={}));var jo={tasks:{},taskGroup:Oo.TASK_GROUP.NONE,taskView:Oo.TASK_VIEW.MY_TASKS},xo=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=_o(this,No(t).call(this,jo,"task",Go,!0))).subscribe=function(){var t=i.a.subscribe("task",function(t){switch(Co.log("Task subscriber ",t),t.type){case"updateTask":return e.Actions.updateTasks([t.data]);case"updateTasks":return e.Actions.updateTasks(t.data);case"expungeTask":return e.Actions.expungeTasks([t.data]);case"expungeTasks":return e.Actions.expungeTasks(t.data);case"setGroup":return e.Actions.setGroup(t.data);case"setView":return e.Actions.setView(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Uo(e,t)}(t,b),Ro(t,[{key:"initialState",get:function(){return jo}},{key:"Constants",get:function(){return Io}}]),Ro(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Io.UPDATE_TASKS:var n=t.tasks,r=wo({},e.tasks);return n.reduce(function(e,t){var n=t.guid;if(null==n)return e;var r=wo({},e[n]||{},t);return e[n]=r,e},r),wo({},e,{tasks:r});case Io.EXPUNGE_TASKS:var o=t.guids,i=wo({},e.tasks);return o.reduce(function(e,t){return delete e[t],e},i),wo({},e,{tasks:i});case Io.SET_TASK_GROUP:return wo({},e,{taskGroup:t.taskGroup});case Io.SET_TASK_VIEW:return wo({},e,{taskView:t.taskView});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateTasks:function(t){e.dispatch({type:Io.UPDATE_TASKS,tasks:t})},expungeTasks:function(t){e.dispatch({type:Io.EXPUNGE_TASKS,guids:t})},setGroup:function(t){e.dispatch({type:Io.SET_TASK_GROUP,taskGroup:t})},setView:function(t){e.dispatch({type:Io.SET_TASK_VIEW,taskView:t})}}}}]),t}()),Do=xo;i.a.register("task.datasource.getTask",function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ko(i,r,o,a,u,"next",e)}function u(e){ko(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xo.getState().tasks[t]);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Lo,Ko=n(378),Fo=n(462),Bo=(n(58),function(e,t){return ft.a.find(e.sharedNotebooks,["recipientUserId",t])});function Mo(e){return(Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vo(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ho(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function Wo(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Ho(i,r,o,a,u,"next",e)}function u(e){Ho(i,r,o,a,u,"throw",e)}a(void 0)})}}function zo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Xo(e,t,n[t])})}return e}function Xo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yo(e,t){return!t||"object"!==Mo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qo(e){return(qo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jo(e,t,n){return t&&Qo(e.prototype,t),n&&Qo(e,n),e}function Zo(e,t){return(Zo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(Lo||(Lo={})).UPDATE_THREADS_FROM_SERVICE="SUGAR/THREADS/UPDATE_THREADS_FROM_SERVICE";var $o="SUGAR/THREADS_DATASOURCE",ei={threads:{}},ti=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Yo(this,qo(t).call(this,ei,"threads",$o,!0))).subscribe=function(){var t=i.a.subscribe("service.threads",function(t){switch(t.type){case"update":e.ServiceActions.update(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zo(e,t)}(t,b),Jo(t,[{key:"initialState",get:function(){return ei}},{key:"Constants",get:function(){return Lo}}]),Jo(t,[{key:"mapInternalToExternalState",value:function(e){return zo({},e.threads)}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Lo.UPDATE_THREADS_FROM_SERVICE:return{threads:zo({},e.threads,t.threads)};default:return e}}},{key:"Actions",get:function(){var e=this;return{getThreadForParticipants:function(){var t=Wo(regeneratorRuntime.mark(function t(n){var r,o,a,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.call("identity.actions.getidentitiesforusers",n);case 2:if(r=t.sent,o=[],a=!1,r.forEach(function(e){e.id||(a=!0),o.push(e.id)}),!a){t.next=8;break}return t.abrupt("return",null);case 8:return u=null,Object.keys(e.state.threads).forEach(function(t){var n=e.state.threads[t];if(n&&n.participantIds){var r=n.participantIds,i=!1;o.forEach(function(e){-1===r.indexOf(e)&&(i=!0)});var a=!1;r.forEach(function(e){-1===o.indexOf(e)&&(a=!0)}),i||a||(u=n)}}),t.abrupt("return",u);case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),createMessageThread:function(){var e=Wo(regeneratorRuntime.mark(function e(t,n){var r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.a.call("identity.actions.getidentitiesforusers",t);case 3:return r=e.sent,o=[],t.forEach(function(e){for(var t=!1,n=0;n<r.length;n++){var i=r[n],a="number"==typeof e&&i.userId===e||"string"==typeof e&&i.contact&&i.contact.id===e;if(i.contact&&a){t=!0,o.push(i.contact);break}}t||o.push({type:Xe.ContactType.EVERNOTE,id:String(e)})}),a=new Fo.CreateMessageThreadSpec({message:n,participants:o,groupThread:o.length>2}),e.next=9,i.a.call("workchat.actions.createMessageThread",{threadSpec:a});case 9:i.a.publish("sync.actions.syncworkchat"),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),e.t0;case 15:case"end":return e.stop()}},e,this,[[0,12]])}));return function(t,n){return e.apply(this,arguments)}}(),sendMessage:function(){var t=Wo(regeneratorRuntime.mark(function t(n,r,o,a){var u,c,s,f,l,p,d,b,y,h,g,S,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.a.call("user.actions.getactiveuser");case 3:if((u=t.sent)&&u.id){t.next=6;break}throw new Error("#sendMessage: no user provided");case 6:if(!(c=Object(Ko.d)())){t.next=13;break}return t.next=10,i.a.call("user.actions.getvaultuserid");case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=u.id;case 14:if(s=t.t0,!c){t.next=21;break}return t.next=18,i.a.call("business.getshard");case 18:t.t1=t.sent,t.next=22;break;case 21:t.t1=u.shardId;case 22:return f=t.t1,(l=Vo(n)).push(u.id||0),l=ft.a.uniq(l),t.next=28,e.Actions.getThreadForParticipants(l);case 28:if(p=t.sent,d=function(t,n,u,c){var d=new Fo.MessageAttachment({type:t,title:u,guid:o.guid,shardId:a?n:f,userId:a?c:s}),b=new Fo.Message({body:r,attachments:[d]});return p?(b.messageThreadId=p.id,i.a.call("workchat.actions.sendMessageToThread",{message:b})):e.Actions.createMessageThread(l,b)},!o){t.next=48;break}if(y=u.shardId,h=u.id,!o.notebookGuid){t.next=40;break}return b=Fo.MessageAttachmentType.NOTE,t.next=37,i.a.call("attachments.actions.getattachment",o.guid);case 37:return(g=t.sent)&&(y=g.shardId,h=g.senderId),t.abrupt("return",d(b,y,o.title,h));case 40:return b=Fo.MessageAttachmentType.NOTEBOOK,t.next=43,i.a.call("linkednotebook.actions.getlinkednotebook",o.guid);case 43:return S=t.sent,v=Bo(o,h),S&&(y=S.shardId),v&&(h=v.sharerUserId),t.abrupt("return",d(b,y,o.name,h));case 48:t.next=53;break;case 50:throw t.prev=50,t.t2=t.catch(0),t.t2;case 53:case"end":return t.stop()}},t,this,[[0,50]])}));return function(e,n,r,o){return t.apply(this,arguments)}}()}}},{key:"ServiceActions",get:function(){var e=this;return{update:function(t){if(t){var n={};t.forEach(function(e){var t=e.messageThread,r=e.lastReadMessageId;n[t.id]=zo({},t,{lastReadMessageId:r||null})}),e.dispatch({type:Lo.UPDATE_THREADS_FROM_SERVICE,threads:n})}}}}}]),t}()),ni=ti;function ri(e){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oi(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function ii(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){oi(i,r,o,a,u,"next",e)}function u(e){oi(i,r,o,a,u,"throw",e)}a(void 0)})}}function ai(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ui(e,t,n[t])})}return e}function ui(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ci(e,t){return!t||"object"!==ri(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function si(e){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function li(e,t,n){return t&&fi(e.prototype,t),n&&fi(e,n),e}function pi(e,t){return(pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("threads.actions.sendmessage",function(){var e=Wo(regeneratorRuntime.mark(function e(t){var n,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userIds,r=t.message,o=t.attachment,i=t.isExternal,e.next=3,ti.Actions.sendMessage(n,r,o,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var di="SUGAR/USER_DATASOURCE",bi={UPDATE_SYNC_STATE:"SUGAR/USERS/UPDATE_SYNC_STATE",UPDATE_USER:"SUGAR/USERS/UPDATE_USER",UPDATE_VAULT_USER:"SUGAR/USERS/UPDATE_VAULT_USER",UPDATE_BUSINESS_SHARD:"SUGAR/USERS/UPDATE_BUSINESS_SHARD",UPDATE_USER_LAST_UPDATED:"SUGAR/USERS/UPDATE_USER_LAST_UPDATED"},yi={user:null,vaultUser:null,vaultUserId:null,businessShardId:null,userLastUpdated:0},hi=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ci(this,si(t).call(this,yi,"user",di,!0))).subscribe=function(){var t=i.a.subscribe("user",function(t){switch(t.type){case"update":return e.Actions.update(t.data);case"setvaultuser":return e.Actions.updateVaultUser(t.data);case"setbusinessshard":return e.Actions.updateBusinessShard(t.data);case"setUserLastUpdated":return e.Actions.updateUserLastUpdated(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pi(e,t)}(t,b),li(t,[{key:"initialState",get:function(){return yi}},{key:"Constants",get:function(){return bi}}]),li(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case bi.UPDATE_USER:return ai({},e,{user:t.user});case bi.UPDATE_VAULT_USER:return ai({},e,{vaultUserId:ft.a.isEmpty(t.vaultUser)?yi.vaultUserId:t.vaultUser.id,vaultUser:t.vaultUser});case bi.UPDATE_BUSINESS_SHARD:return ai({},e,{businessShardId:t.businessShardId});case bi.UPDATE_USER_LAST_UPDATED:return ai({},e,{userLastUpdated:t.userLastUpdated});default:return e}}},{key:"Actions",get:function(){var e=this;return{getActiveUser:function(){var t=ii(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getState().user);case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getActiveUserId:function(){var t=ii(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getState(),null!=(r=n.user)){t.next=3;break}return t.abrupt("return",null);case 3:return t.abrupt("return",r.id);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getVaultUser:function(){var t=ii(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getState().vaultUserId);case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),update:function(t){e.dispatch({type:bi.UPDATE_USER,user:t})},updateVaultUser:function(t){e.dispatch({type:bi.UPDATE_VAULT_USER,vaultUser:t})},updateBusinessShard:function(t){e.dispatch({type:bi.UPDATE_BUSINESS_SHARD,businessShardId:t})},updateUserLastUpdated:function(t){e.dispatch({type:bi.UPDATE_USER_LAST_UPDATED,userLastUpdated:t})}}}}]),t}()),gi=hi;function Si(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}i.a.register("user.actions.getactiveuser",ii(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hi.dataSourceInitialized;case 2:return e.abrupt("return",hi.Actions.getActiveUser());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("user.actions.getactiveuserid",ii(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hi.dataSourceInitialized;case 2:return e.abrupt("return",hi.Actions.getActiveUserId());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("user.actions.getvaultuserid",ii(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hi.dataSourceInitialized;case 2:return e.abrupt("return",hi.Actions.getVaultUser());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("user.actions.getUserLastUpdated",ii(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hi.dataSourceInitialized;case 2:return e.abrupt("return",hi.getState().userLastUpdated||0);case 3:case"end":return e.stop()}},e,this)}))),n.d(t,"clearTables",function(){return Ti}),n.d(t,"logDataSources",function(){return wi}),n.d(t,"logCompressedDataSources",function(){return Ai}),n.d(t,"Attachments",function(){return R}),n.d(t,"CommEngine",function(){return V}),n.d(t,"Config",function(){return re}),n.d(t,"Flow",function(){return Re}),n.d(t,"HVA",function(){return We}),n.d(t,"Identity",function(){return ut}),n.d(t,"LinkedNotebook",function(){return wt}),n.d(t,"Note",function(){return Zn}),n.d(t,"Notebook",function(){return gn}),n.d(t,"Preference",function(){return br}),n.d(t,"Profile",function(){return Ur}),n.d(t,"QuickSwitcher",function(){return Hr}),n.d(t,"Survey",function(){return Eo}),n.d(t,"Tag",function(){return Cn}),n.d(t,"Task",function(){return Do}),n.d(t,"Threads",function(){return ni}),n.d(t,"User",function(){return gi}),n.d(t,"Workspace",function(){return Zt});var vi,mi,Ei=Object(a.default)("ion:sugar"),Oi={Attachments:R,CommEngine:V,Config:re,Flow:Re,HVA:We,Identity:ut,LinkedNotebook:wt,Note:Zn,Notebook:gn,Preference:br,Profile:Ur,Promotion:ve,QuickSwitcher:Hr,Search:oo,Survey:Eo,Tag:Cn,Task:Do,Threads:ni,User:gi,Workspace:Zt};t.default=Oi;function ki(){return(ki=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Si(i,r,o,a,u,"next",e)}function u(e){Si(i,r,o,a,u,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!mi){e.next=5;break}return b.reset(),t=b.getInstances().map(function(e){return e.deInit()}),e.next=5,Promise.all(t);case 5:vi="",mi=null;case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function Ti(){b.getInstances().forEach(function(e){e.deleteState(vi)})}function wi(){Ei.log("DataSource getInstances returns",b.getInstances())}function Ai(){var e={};b.getInstances().forEach(function(t){r.default.get(Object(o.a)(t.namespace),t.tableName).then(function(n){for(var r={},o=Object.keys(n),i=0;i<o.length;i++){var a=o[i];Array.isArray(n[a])?r[a]=n[a].length:r[a]=Object.keys(n[a]).length}e["".concat(t.namespace,"_").concat(t.tableName)]=r})}),Ei.log("logCompressedDataSources returns",JSON.stringify(e))}i.a.register("sugar.init",function(e){return mi?String(e)!==vi?Promise.reject():mi:mi=new Promise(function(t){vi=String(e);var n=b.getInstances().map(function(e){return e.init(vi)});Promise.all(n).then(function(){return t()})})}),i.a.register("sugar.deinit",function(){return ki.apply(this,arguments)})},521:function(e,t,n){"use strict";n.r(t);var r=n(30),o=n(104),i=n(22);function a(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){a(i,r,o,u,c,"next",e)}function c(e){a(i,r,o,u,c,"throw",e)}u(void 0)})}}var c=Object(i.default)("ion:cupboard:migration"),s=[],f=function(){var e=u(regeneratorRuntime.mark(function e(t,n,r){var o,i,a,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){var e=o(t),r=o(n);if(-1===r)throw new Error("No migration object found for target version ".concat(n));if(e>r)throw new Error("Downgrade operation is not supported. ".concat(t," ").concat(n));if(e!==r)return a(i(e,r));c.warn("Migration path called for same current and target versions ".concat(t," ").concat(n))},f=function(){return(f=u(regeneratorRuntime.mark(function e(o){var i,a,u,s,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c.info("Starting cupboard upgrade from ".concat(t," to ").concat(n)),i=!0,a=!1,u=void 0,e.prev=4,s=o[Symbol.iterator]();case 6:if(i=(f=s.next()).done){e.next=13;break}return l=f.value,e.next=10,l.upgradeFn(r);case 10:i=!0,e.next=6;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(4),a=!0,u=e.t0;case 19:e.prev=19,e.prev=20,i||null==s.return||s.return();case 22:if(e.prev=22,!a){e.next=25;break}throw u;case 25:return e.finish(22);case 26:return e.finish(19);case 27:c.info("Finished cupboard upgrade from ".concat(t," to ").concat(n));case 28:case"end":return e.stop()}},e,this,[[4,15,19,27],[20,,22,26]])}))).apply(this,arguments)},a=function(e){return f.apply(this,arguments)},i=function(e,t){return s.slice(e+1,t+1)},o=function(e){return s.findIndex(function(t){return t.key===e})},e.abrupt("return",l());case 6:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}(),l={key:"ION_9807",upgradeFn:function(e){if(null==e||""===e)return Promise.resolve();return o.a.call("cupboard.clearNamespace",{namespace:e})}};s.push(l);var p=f,d=n(43),b=n.n(d);function y(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){y(i,r,o,a,u,"next",e)}function u(e){y(i,r,o,a,u,"throw",e)}a(void 0)})}}var g=Object(i.default)("ion:cupboard"),S=Object(r.b)().objectPersistence,v=function(e,t){return null==e?t:"".concat(e,"_").concat(t)},m={clear:function(){return new Promise(function(e){S.clear().then(function(){return e()}).catch(g.error)})},clearNamespace:function(){var e=h(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.keys();case 2:return n=e.sent,r=n.filter(function(e){return e.startsWith(t)}),e.next=6,Promise.all(r.map(function(e){return S.removeItem(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),get:function(e,t){return new Promise(function(n){var r=v(e,t);S.getItem(r).then(function(e){return n(e)}).catch(function(e){return g.error(e)})})},set:function(){var e=h(regeneratorRuntime.mark(function e(t,n,r){var o,i,a=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.length>3&&void 0!==a[3]&&a[3],e.next=3,this.get(t,"SCHEMA_VERSION");case 3:if(i=e.sent,o||i===b.a.SCHEMA_VERSION){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,S.setItem(v(t,n),r);case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}(),migrate:function(){var e=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t,"SCHEMA_VERSION");case 2:if(n=e.sent,e.prev=3,n===b.a.SCHEMA_VERSION){e.next=7;break}return e.next=7,p(n,b.a.SCHEMA_VERSION,t);case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(3),g.error("Failed to migrate to version ".concat(b.a.SCHEMA_VERSION," from ").concat(n," error ").concat(JSON.stringify(e.t0),". Clearing cupboard.")),e.next=14,this.clear();case 14:return e.prev=14,e.next=17,this.set(t,"SCHEMA_VERSION",b.a.SCHEMA_VERSION,!0);case 17:return e.finish(14);case 18:case"end":return e.stop()}},e,this,[[3,9,14,18]])}));return function(t){return e.apply(this,arguments)}}()};o.a.register("cupboard.get",function(e){var t=e.namespace,n=e.key;return m.get(t,n)}),o.a.register("cupboard.set",function(e){var t=e.namespace,n=e.key,r=e.value,o=e.forceWrite;return m.set(t,n,r,o)}),o.a.register("cupboard.clear",function(){return m.clear()}),o.a.register("cupboard.clearNamespace",function(e){var t=e.namespace;return m.clearNamespace(t)}),o.a.register("cupboard.migrate",function(e){var t=e.namespace;return m.migrate(t)});t.default=m}}]);